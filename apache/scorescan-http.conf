# HTTP-only configuration (for development or behind a separate TLS terminator)
<VirtualHost *:80>
    ServerName scorescan.example.com
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/scorescan_error.log
    CustomLog ${APACHE_LOG_DIR}/scorescan_access.log combined
    
    # Enable required modules (ensure these are enabled):
    # sudo a2enmod proxy proxy_http rewrite headers
    
    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    
    # Proxy settings
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Backend API - proxy to FastAPI backend
    ProxyPass /api http://localhost:8000/api
    ProxyPassReverse /api http://localhost:8000/api
    
    # API documentation endpoints
    ProxyPass /docs http://localhost:8000/docs
    ProxyPassReverse /docs http://localhost:8000/docs
    ProxyPass /redoc http://localhost:8000/redoc
    ProxyPassReverse /redoc http://localhost:8000/redoc
    ProxyPass /openapi.json http://localhost:8000/openapi.json
    ProxyPassReverse /openapi.json http://localhost:8000/openapi.json
    
    # Health check endpoint
    ProxyPass /health http://localhost:8000/health
    ProxyPassReverse /health http://localhost:8000/health
    
    # Frontend - proxy to Vite dev server
    ProxyPass / http://localhost:5173/
    ProxyPassReverse / http://localhost:5173/
    
    # WebSocket support for Vite HMR (Hot Module Replacement)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) ws://localhost:5173/$1 [P,L]
    
    # Increase timeouts for long-running requests
    ProxyTimeout 300
    
    # Increase max upload size (50MB)
    LimitRequestBody 52428800
</VirtualHost>
